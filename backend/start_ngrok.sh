#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ ngrok —Ç—É–Ω–Ω–µ–ª—è –∫ Django —Å–µ—Ä–≤–µ—Ä—É
# ‚ö†Ô∏è –í–†–ï–ú–ï–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ Figma
# –ü–æ—Å–ª–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ production —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./start_ngrok.sh

echo "üöÄ –ó–∞–ø—É—Å–∫ ngrok —Ç—É–Ω–Ω–µ–ª—è –∫ localhost:8000..."
echo "‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –≠—Ç–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏!"
echo ""

# –ó–∞–ø—É—Å–∫–∞–µ–º ngrok –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
ngrok http 8000 --log=stdout > /tmp/ngrok.log 2>&1 &

# –ñ–¥—ë–º –Ω–µ–º–Ω–æ–≥–æ, —á—Ç–æ–±—ã ngrok –∑–∞–ø—É—Å—Ç–∏–ª—Å—è
sleep 3

# –ü–æ–ª—É—á–∞–µ–º –ø—É–±–ª–∏—á–Ω—ã–π URL –∏–∑ –ª–æ–≥–æ–≤ ngrok
NGROK_URL=$(curl -s http://localhost:4040/api/tunnels | grep -o '"public_url":"https://[^"]*"' | head -1 | cut -d'"' -f4)

if [ -z "$NGROK_URL" ]; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å ngrok URL. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ ngrok –∑–∞–ø—É—â–µ–Ω."
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å http://localhost:4040 –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ ngrok"
    exit 1
fi

echo "‚úÖ Ngrok —Ç—É–Ω–Ω–µ–ª—å –∑–∞–ø—É—â–µ–Ω!"
echo ""
echo "üåê –ü—É–±–ª–∏—á–Ω—ã–π URL: $NGROK_URL"
echo ""
echo "üìù –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç URL –≤ Figma –≤–º–µ—Å—Ç–æ http://localhost:8000"
echo "   –ù–∞–ø—Ä–∏–º–µ—Ä: ${NGROK_URL}/api/v1"
echo ""
echo "üí° –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ ngrok –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: pkill ngrok"
echo "üí° –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤: tail -f /tmp/ngrok.log"
echo "üí° –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å ngrok: http://localhost:4040"
echo ""

# –°–æ—Ö—Ä–∞–Ω—è–µ–º URL –≤ —Ñ–∞–π–ª –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
echo "$NGROK_URL" > /tmp/ngrok_url.txt
echo "URL —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ /tmp/ngrok_url.txt"


# Руководство оператора: Банковские платежи

Руководство для оператора — сотрудника, который создаёт платёжные поручения на основе входящих счетов и отправляет их на согласование.

---

## Содержание

1. [Загрузка и распознавание входящего счёта](#1-загрузка-и-распознавание-входящего-счёта)
2. [Выбор компании и банковского счёта](#2-выбор-компании-и-банковского-счёта)
3. [Заполнение реквизитов получателя](#3-заполнение-реквизитов-получателя)
4. [Создание платёжного поручения и отправка на согласование](#4-создание-платёжного-поручения-и-отправка-на-согласование)
5. [Статусы платёжного поручения](#5-статусы-платёжного-поручения)

---

## 1. Загрузка и распознавание входящего счёта

### Шаг 1: Создание расходного платежа

1. Перейдите в раздел **Платежи**.
2. Нажмите **Создать платёж**.
3. Выберите тип **Расход**.

### Шаг 2: Загрузка PDF-счёта

1. В форме создания платежа найдите блок **Загрузка счёта**.
2. Перетащите файл счёта (PDF, PNG или JPG) в область загрузки или нажмите для выбора файла.
3. Дождитесь автоматического распознавания — система использует LLM для извлечения данных из документа.

### Шаг 3: Проверка распознанных данных

После распознавания форма **автоматически заполнится**:

- **Контрагент** — поставщик из счёта (подставляется при точном совпадении ИНН);
- **Наша компания** — счёт плательщика (если юрлицо найдено в системе);
- **Суммы** — итоговая сумма и НДС;
- **Дата и описание** — дата и номер счёта.

**Важно:** При низкой точности распознавания (confidence < 0.7) проверьте все данные вручную.

### Шаг 4: Сохранение платежа

1. При необходимости скорректируйте позиции товаров, категорию расходов и другие поля.
2. Сохраните платёж — он получит статус «Запланирован» и появится в **Реестре платежей**.

---

## 2. Выбор компании и банковского счёта

Для создания платёжного поручения необходимо выбрать:

1. **Банковский счёт списания** — счёт, с которого будет списана сумма.

Счета отображаются в формате: **Название счёта (Номер счёта)**, например:
- «Основной счёт ООО Август (40702810000000000001)»

**Условия:**

- Банковский счёт должен быть привязан к банковскому подключению в настройках;
- Подключение должно быть активным;
- Внутренний счёт (Account) должен принадлежать одной из компаний в системе.

---

## 3. Заполнение реквизитов получателя

### Автоподстановка из контрагента

Если платёж связан с контрагентом (поставщиком), реквизиты могут подставляться из карточки контрагента:

| Поле | Описание | Источник |
|------|----------|----------|
| Наименование получателя | ООО "Ромашка" | Контрагент → name |
| ИНН | 1234567890 | Контрагент → inn |
| КПП | 123456789 | Контрагент → kpp |
| Расчётный счёт | 40702810... | Контрагент → bank_account |
| Банк получателя | Наименование банка | Контрагент → bank_name |
| БИК | 044525225 | Контрагент → bank_bik |
| Корр. счёт банка | 30101810... | Контрагент → bank_corr_account |

**Примечание:** Если автоподстановка не сработала, введите данные вручную по счёту поставщика.

### Обязательные поля

- **Наименование получателя** — полное наименование организации;
- **ИНН** — 10 или 12 цифр;
- **Расчётный счёт** — 20 цифр;
- **Банк получателя** — наименование банка;
- **БИК** — 9 цифр.

### Дополнительные поля

- **КПП** — для юрлиц (9 цифр);
- **Корр. счёт банка** — корреспондентский счёт банка получателя (20 цифр).

---

## 4. Создание платёжного поручения и отправка на согласование

### Шаг 1: Открытие формы создания

1. Перейдите в раздел **Платёжные поручения**.
2. Нажмите **Создать поручение**.

### Шаг 2: Заполнение формы

1. Выберите **Счёт списания** (банковский счёт).
2. Заполните **реквизиты получателя** (см. раздел выше).
3. Укажите **Сумму** и **Дату оплаты**.
4. Заполните **Назначение платежа** (обязательно).
5. При необходимости укажите **НДС** (например: «В т.ч. НДС 20% — 1000.00 руб.» или «Без НДС»).

### Шаг 3: Создание черновика

Нажмите **Создать** — платёжное поручение будет создано в статусе **Черновик**.

### Шаг 4: Отправка на согласование

1. Откройте созданное поручение (клик по строке в таблице).
2. Нажмите кнопку **На согласование**.

Платёж перейдёт в статус **На согласовании** и станет доступен контролёру для одобрения или отклонения.

---

## 5. Статусы платёжного поручения

| Статус | Код | Описание |
|--------|-----|----------|
| **Черновик** | `draft` | Создано оператором, можно редактировать. Перед отправкой на согласование нажмите «На согласование». |
| **На согласовании** | `pending_approval` | Ожидает решения контролёра. Можно одобрить или отклонить. |
| **Одобрено** | `approved` | Контролёр одобрил. Ожидает наступления даты оплаты для автоматической отправки в банк или ручной отправки. |
| **Отправлено в банк** | `sent_to_bank` | Платёж отправлен в банк. В режиме автоподписи может сразу перейти в «Исполнено». |
| **Ожидает подписи** | `pending_sign` | Платёж создан в банке как черновик. Требуется подпись в личном кабинете банка. |
| **Исполнено** | `executed` | Платёж успешно исполнен банком. Деньги списаны. |
| **Отклонено** | `rejected` | Контролёр отклонил поручение. Оператор может создать новое. |
| **Ошибка** | `failed` | Ошибка при отправке в банк или отклонение банком. Проверьте сообщение об ошибке. |

### Жизненный цикл платёжного поручения

```
Черновик → На согласовании → Одобрено → Отправлено в банк / Ожидает подписи → Исполнено
                  ↓
            Отклонено
```

---

## Полезные советы

1. **Проверяйте ИНН и КПП** — ошибки в реквизитах приводят к возврату платежа банком.
2. **Назначение платежа** — указывайте номер и дату счёта для связи с документом.
3. **Связь с реестром** — при создании поручения из заявки в реестре можно указать `payment_registry` для связи с внутренним платежом.

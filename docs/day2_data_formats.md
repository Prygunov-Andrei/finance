# День 2. Формат данных и регламент обновления

## 1. Формат табличных файлов

### 1.1. Файл «Фактические платежи» (payments_actual.xlsx)
- **Лист `payments`**:
  - `object_code` — код объекта (строка, *обязательно*).
  - `object_name` — название объекта (строка, *обязательно*).
  - `contract_number` — номер договора (строка, *обязательно*).
  - `contract_party` — контрагент (строка).
  - `payment_type` — расход / поступление (строка, *обязательно*).
  - `payment_date` — дата платежа (дата, *обязательно*).
  - `amount` — сумма (число, *обязательно*).
  - `company_account` — счёт компании (строка).
  - `description` — назначение платежа (строка).
  - `document_link` — путь/ссылка на первичный документ (строка).
  - `import_batch_id` — идентификатор импорта (строка, заполняется системой).

### 1.2. Файл «Плановые платежи» (payments_plan.xlsx)
- **Лист `planned_payments`**:
  - `object_code`
  - `contract_number`
  - `planned_date`
  - `amount`
  - `status` — планируется / утверждено / отменено.
  - `initiator` — инициатор платежа.
  - `comment`

### 1.3. Файл «Поступления» (incomes.xlsx)
- **Лист `incomes`**:
  - `object_code`
  - `contract_number`
  - `income_date`
  - `amount`
  - `payer`
  - `description`

### 1.4. Файл «Задолженность» (balance.xlsx)
- **Лист `debts`**:
  - `object_code`
  - `contract_number`
  - `debt_type` — дебиторская / кредиторская.
  - `amount`
  - `as_of_date`

### Общие требования к файлам
- Формат: Excel (.xlsx) или CSV в UTF-8.
- Названия листов фиксированы.
- Первая строка — заголовки колонок.
- Даты — `YYYY-MM-DD`.
- Суммы — десятичные значения с точкой.

## 2. Шаблон тестовых данных
- Файлы-шаблоны размещены в `docs/sample_data/`:
  - `payments_actual_sample.xlsx`
  - `payments_plan_sample.xlsx`
  - `incomes_sample.xlsx`
  - `balance_sample.xlsx`
- Каждый содержит 3–5 строк с примером заполнения.
- В комментариях указаны допустимые значения статусов и формат ссылок на документы.

## 3. Регламент обновления и версионирования
1. **Ответственные**
   - Подготовка и загрузка файлов — Финансовый аналитик.
   - Проверка корректности и утверждение — Финансовый директор.
2. **Частота обновления**
   - Фактические платежи и поступления — ежедневно при наличии операций.
   - Плановые платежи и задолженность — минимум раз в неделю.
3. **Версионирование**
   - Каждая загрузка получает уникальный `import_batch_id`.
   - Исходные файлы архивируются с меткой времени `YYYYMMDD_HHMM`.
   - Изменения структуры фиксируются в журнале `docs/data_format_changelog.md`.
4. **Контроль перед импортом**
   - Проверка обязательных колонок и форматов дат.
   - Сверка сумм по объекту с предварительным отчётом.
   - Поиск дублирующих строк по ключу (`object_code`, `contract_number`, `payment_date`, `amount`).
